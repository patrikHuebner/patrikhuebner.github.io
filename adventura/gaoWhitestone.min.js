function preload(){sound=loadSound("mp3/MikeGao-Adventura96kbps.mp3");var a;a=loadImage("img/cover.jpg"),a=loadImage("img/env2/negx.jpg"),a=loadImage("img/env2/negy.jpg"),a=loadImage("img/env2/negz.jpg"),a=loadImage("img/env2/posx.jpg"),a=loadImage("img/env2/posy.jpg"),a=loadImage("img/env2/posz.jpg")}function setup(){}function playPause(){loaded?(sound.pause(),jQuery("#pauseSpan").html("Play"),loaded=!1):(sound.play(),jQuery("#pauseSpan").html("Pause"),loaded=!0)}function muteMe(){muted?(sound.setVolume(1),jQuery("#muteSpan").html("Mute"),muted=!1):(sound.setVolume(0),jQuery("#muteSpan").html("Un-mute"),muted=!0)}function startSketch(){jQuery("#playWrapper").remove(),fft=new p5.FFT(.9,16),analyzer=new p5.Amplitude,analyzer.smooth(.6),init(),loaded=!0,sound.loop(),startTheSketch=!0,animate(),addCueSet()}function createCanvasElements(){maxAnisotropy=renderer.getMaxAnisotropy(),canvasLineAnimation=document.createElement("canvas"),context1=canvasLineAnimation.getContext("2d"),texture1=new THREE.Texture(canvasLineAnimation),texture1.minFilter=THREE.LinearFilter,texture1.anisotropy=maxAnisotropy,texture1.needsUpdate=!0,material1=new THREE.MeshBasicMaterial({map:texture1,side:THREE.DoubleSide}),material1.transparent=!0;var a=new THREE.Mesh(new THREE.PlaneGeometry(canvasLineAnimation.width,canvasLineAnimation.height),material1);a.position.set(0,0,0),scene.add(a),canvasLineAnimation.width*=3,canvasLineAnimation.height*=3,canvasTextAnimation=document.createElement("canvas"),context2=canvasTextAnimation.getContext("2d"),texture2=new THREE.Texture(canvasTextAnimation),texture2.minFilter=THREE.LinearFilter,texture2.anisotropy=maxAnisotropy,texture2.needsUpdate=!0,material2=new THREE.MeshBasicMaterial({map:texture2,side:THREE.DoubleSide}),material2.transparent=!0;var b=new THREE.Mesh(new THREE.PlaneGeometry(canvasTextAnimation.width,canvasTextAnimation.height),material2);b.position.set(0,0,30),scene.add(b),canvasTextAnimation.width*=3,canvasTextAnimation.height*=3,Speak(myLines[curLine]),canvasObjectAnimation=document.createElement("canvas"),context3=canvasObjectAnimation.getContext("2d"),texture3=new THREE.Texture(canvasObjectAnimation),texture3.minFilter=THREE.LinearFilter,texture3.anisotropy=maxAnisotropy,texture3.needsUpdate=!0,material3=new THREE.MeshBasicMaterial({map:texture3,side:THREE.DoubleSide}),material3.transparent=!0;var c=new THREE.Mesh(new THREE.PlaneGeometry(4*canvasObjectAnimation.width,4*canvasObjectAnimation.height),material3);c.position.set(0,0,-50),scene.add(c),canvasObjectAnimation.width*=3,canvasObjectAnimation.height*=3}function animateCanvasLineAnimation(){spectrum.length;tickCharacter++,context1.clearRect(0,0,canvasLineAnimation.width,canvasLineAnimation.height),context2.clearRect(0,0,canvasTextAnimation.width,canvasTextAnimation.height),context2.strokeStyle="#ffffff";var c=150,d=150;context2.strokeRect((canvasTextAnimation.width-c)/2,(canvasTextAnimation.height-d)/2,c,d);var e=110,f=45,g=(canvasTextAnimation.width-e)/2,h=210;text=curText,tickCharacter%20>10&&(text+="_"),context2.font="Bold 35px Arial",context2.fillStyle="#ffffff",wrapText(context2,text,g,h,e,f),context1.lineWidth=2,context1.save(),context1.rotate(delta*Math.PI/180),context1.strokeStyle="#ffffff";var c=150,d=150;context1.strokeRect((canvasTextAnimation.width-c)/2,(canvasTextAnimation.height-d)/2,c,d),context1.restore();var i=canvasLineAnimation.width/2,j=canvasLineAnimation.height/2;context1.strokeStyle="#8d8384",context1.lineWidth=20*rms,context1.beginPath(),context1.arc(i+.1*JSmouseX,j+.1*JSmouseY,150,0,2*Math.PI,!1),context1.stroke(),context1.strokeStyle="#ff6600",context1.lineWidth=40*rms,context1.beginPath(),context1.arc(i+.01*JSmouseX,j+.01*JSmouseY,200,0,2*Math.PI,!1),context1.stroke(),context1.strokeStyle="#8d8384",context1.lineWidth=60*rms,context1.beginPath(),context1.arc(i+.2*JSmouseX,j+.2*JSmouseY,350,0,2*Math.PI,!1),context1.stroke(),context1.lineWidth=80*rms,context1.beginPath(),context1.arc(i+.1*JSmouseX,j+.1*JSmouseY,450,0,2*Math.PI,!1),context1.stroke(),texture1.needsUpdate=!0,texture2.needsUpdate=!0}function wrapText(a,b,c,d,e,f){for(var g=b.split(" "),h="",i=0;i<g.length;i++){var j=h+g[i]+" ",k=context2.measureText(j),l=k.width;l>e&&i>0?(context2.fillText(h,c,d),h=g[i]+" ",d+=f):h=j}context2.fillText(h,c,d)}function Speak(a,b){fullText=a,currentOffset=0,myTimer=setInterval(onTick,480)}function onTick(){if(currentOffset++,currentOffset==fullText.length)return void complete();var a=fullText.substring(0,currentOffset);curText=a}function complete(){clearInterval(myTimer),myTimer=null,curText=fullText,curLine<myLines.length-1?curLine++:curLine=0,Speak(myLines[curLine])}function animateCircles(){if(context3.clearRect(0,0,canvasObjectAnimation.width,canvasObjectAnimation.height),rms>.5){var a=createVector(random(canvasObjectAnimation.width),random(canvasObjectAnimation.height));myBlock=new Block(a),blocks.push(myBlock)}for(var b=0;b<blocks.length;b++)myBlock=blocks[b],myBlock.run(b);texture3.needsUpdate=!0}function getChar(a){for(var b="",c="GAO",d=0;d<a;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b}function Block(a){this.loc=a,this.vel=createVector(random(-1,1),random(-1,1)),this.style=random(0,1),this.myColor="#fff",this.style<.2&&(this.myColor="#ff6600"),this.myText=getChar(1),this.acc=createVector(-rms,rms),rms>.4?this.lifeSpan=Math.floor(200*rms):this.lifeSpan=50,this.run=function(a){this.lifeSpan>0?this.lifeSpan--:blocks.splice(a,1),this.checkBoundaries(),this.move(),this.draw()},this.checkBoundaries=function(){(this.loc.x<0||this.loc.x>width)&&(this.vel.x*=-1),(this.loc.y<0||this.loc.y>height)&&(this.vel.y*=-1)},this.move=function(){this.vel.add(this.acc),this.loc.add(this.vel)},this.draw=function(){animateRandomCharacters?(context3.font="Bold "+this.lifeSpan+"px Arial",context3.fillStyle=this.myColor,context3.fillText(this.myText,this.loc.x,this.loc.y)):(context3.beginPath(),context3.arc(this.loc.x,this.loc.y,this.lifeSpan,0,2*Math.PI,!1),this.style<.5?(context3.fillStyle=this.myColor,context3.fill()):(context3.lineWidth=2,context3.strokeStyle=this.myColor,context3.stroke()),context3.stroke())}}function addLights(){var a=5.5,b=100,c=2,d=16737792,e=16737792,f=16737792,g=16777215,h=16737792,i=16737792,j=new THREE.SphereGeometry(.25,16,8);light1=new THREE.PointLight(d,a,b,c),light1.add(new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:d}))),scene.add(light1),light2=new THREE.PointLight(e,a,b,c),light2.add(new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:e}))),scene.add(light2),light3=new THREE.PointLight(f,a,b,c),light3.add(new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:f}))),scene.add(light3),light4=new THREE.PointLight(g,a,b,c),light4.add(new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:g}))),scene.add(light4),light5=new THREE.PointLight(h,a,b,c),light5.add(new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:h}))),scene.add(light5),light6=new THREE.PointLight(i,a,b,c),light6.add(new THREE.Mesh(j,new THREE.MeshBasicMaterial({color:i}))),scene.add(light6)}function animateLights(){lightTime+=.0025;var b=150;light1.position.x=Math.sin(.7*lightTime)*b,light1.position.y=Math.sin(.3*lightTime)*b,light1.position.z=Math.cos(.3*lightTime)*b,light2.position.x=Math.cos(.3*lightTime)*b,light2.position.y=Math.cos(.9*lightTime)*b,light2.position.z=Math.sin(.7*lightTime)*b,light3.position.x=Math.sin(.7*lightTime)*b,light3.position.y=Math.cos(.2*lightTime)*b,light3.position.z=Math.sin(.5*lightTime)*b,light4.position.x=Math.sin(.3*lightTime)*b,light4.position.z=Math.sin(.5*lightTime)*b,light5.position.x=Math.cos(.3*lightTime)*b,light5.position.z=Math.sin(.5*lightTime)*b,light6.position.x=Math.cos(.7*lightTime)*b,light6.position.z=Math.cos(.5*lightTime)*b;var c=analyzer.getLevel(),d=100;light4.intensity=c*d,light4.distance=100+c*d,light1.intensity=c*d,light1.distance=100+c*d,light2.intensity=c*d,light2.distance=100+c*d,light3.intensity=c*d,light3.distance=100+c*d,light5.intensity=c*d,light5.distance=100+c*d,light6.intensity=c*d,light6.distance=100+c*d}function followLights(){camera.position.set(light6.position.x,Math.abs(100*Math.sin(.5*lightTime)),light6.position.z)}function animateCamTo(){camera.position.set(camPos.x,camPos.y,camPos.z),camera.fov=camPos.fov,camera.lookAt(scene.position),camera.updateProjectionMatrix()}function init(){container=document.getElementById("canvasID"),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),camera.position.z=450,scene=new THREE.Scene;var a=new THREE.AmbientLight(1052720);scene.add(a);var b=new THREE.DirectionalLight(16772829);b.position.set(0,0,1),scene.add(b);var c="img/env2/",d=".jpg",e=[c+"posx"+d,c+"negx"+d,c+"posy"+d,c+"negy"+d,c+"posz"+d,c+"negz"+d];textureCube=(new THREE.CubeTextureLoader).load(e),textureCube.format=THREE.RGBFormat;var f=new THREE.LoadingManager;f.onProgress=function(a,b,c){};var g=new THREE.Texture,h=function(a){if(a.lengthComputable){a.loaded/a.total*100}},i=function(a){},j=new THREE.ImageLoader(f);j.load("img/solidTexture.png",function(a){g.image=a,g.needsUpdate=!0});var k=new THREE.MeshPhongMaterial({specular:1644825,color:16777215,shininess:100,reflectivity:1.2,envMap:textureCube}),l=new THREE.MeshPhongMaterial({specular:1644825,map:g,shininess:1,reflectivity:.2,envMap:textureCube,combine:THREE.MixOperation,blending:THREE.AdditiveBlending}),j=new THREE.OBJLoader(f),m="obj/BanzBowinkel.obj";j.load(m,function(a){a.traverse(function(a){a instanceof THREE.Mesh&&(a.material=k,a.material.map=g)}),a.name="sceneObject",a.position.y=-125,a.position.z=-120,scene.add(a),a.visible=!1},h,i),j.load(m,function(a){a.traverse(function(a){a instanceof THREE.Mesh&&(a.material=k,a.material.map=g)}),a.name="copiedSceneObject",a.position.y=-125,a.position.z=-120,objectCopy=a},h,i);var n=new THREE.SphereGeometry(500,60,40);n.scale(-1,1,1),envMesh=new THREE.Mesh(n,l),scene.add(envMesh),envMesh.visible=!1,renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0,antialias:!1}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,container.appendChild(renderer.domElement),document.addEventListener("mousemove",onDocumentMouseMove,!1),document.addEventListener("touchstart",onDocumentTouchStart,!1),document.addEventListener("touchmove",onDocumentTouchMove,!1),stats=new Stats,statsDIV.appendChild(stats.dom),window.addEventListener("resize",onWindowResize,!1),createCanvasElements(),addLights(),jQuery("#preloader").remove()}function onWindowResize(){windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function onDocumentMouseMove(a){JSmouseX=(a.clientX-windowHalfX)/2,JSmouseY=(a.clientY-windowHalfY)/2}function onDocumentTouchStart(a){JSmouseX=a.touches[0].pageX-windowHalfX,JSmouseY=0}function onDocumentTouchMove(a){1===a.touches.length&&(JSmouseX=a.touches[0].pageX-windowHalfX,JSmouseY=0)}function animate(){requestAnimationFrame(animate),startTheSketch&&(rms>.01&&!audioIsPlaying&&(audioIsPlaying=!0,jQuery("#mobileInfo").remove()),1==loaded&&(spectrum=fft.analyze(),rms=analyzer.getLevel(),audioIsPlaying&&render(),stats.update()))}function render(){deltaA+=.001,delta=clock.getDelta(),animateCanvasLineAnimation(),animateForeground&&animateCircles(),animateLight&&animateLights(),followLight&&followLights(),void 0==mainObject&&(mainObject=scene.getObjectByName("sceneObject",!0)),scaleObject&&(myScale=Math.cos(deltaA),void 0!=mainObject&&(mainObject.scale.x=myScale,mainObject.scale.y=myScale,mainObject.scale.z=myScale)),rotateObjectSmooth&&(mainObject.rotation.y+=.005),objectRotation&&void 0!=mainObject&&rms>.4&&(mainObject.rotation.x+=.01*rms,mainObject.rotation.y+=.01*rms,mainObject.rotation.z+=.01*rms);var a=0,b=spectrum.length-1;if(deformMesh)for(var c=0;c<mainObject.children.length;c++)for(var d=0;d<mainObject.children[c].geometry.attributes.position.array.length;d++)d%moduloDeform==moduloTarget&&(mainObject.children[c].geometry.attributes.position.array[d]=objectCopy.children[c].geometry.attributes.position.array[d]+spectrum[a]*boostDeform+1e-6,mainObject.children[c].geometry.attributes.position.needsUpdate=!0,a<b?a++:a=0);scene.position.x+=.05*(JSmouseX-scene.position.x),scene.position.y+=.05*(-JSmouseY-scene.position.y),camera.lookAt(scene.position),renderer.render(scene,camera)}function isTouchSupported(){var a=window.navigator.msMaxTouchPoints,b="ontouchstart"in document.createElement("div");return!(!a&&!b)}function addCueSet(){sound.addCue(2.01,function(){camPos.z=200,animateCamTo(),jQuery("#canvasOverlaySpan").html("G")}),sound.addCue(2.74,function(){camPos.z=900,animateCamTo(),jQuery("#canvasOverlaySpan").html("A")}),sound.addCue(2.98,function(){camPos.z=450,animateCamTo(),jQuery("#canvasOverlaySpan").html("O")}),sound.addCue(3.5,function(){jQuery("#canvasOverlaySpan").html("")}),sound.addCue(7.5,function(){TweenLite.to(camPos,6.7,{x:0,y:0,z:0,fov:145,ease:Quad.easeIn,onUpdate:animateCamTo})}),sound.addCue(15.54,function(){showObject(),moduloDeform=50,deformMesh=!0,TweenLite.to(camPos,2,{x:0,y:0,z:450,fov:45,ease:Quad.easeOut,onUpdate:animateCamTo})}),sound.addCue(17.72,function(){jQuery("#canvasOverlaySpan").html("G"),camPos.z=700,animateCamTo()}),sound.addCue(17.96,function(){jQuery("#canvasOverlaySpan").html("A"),camPos.z=900,animateCamTo()}),sound.addCue(18.45,function(){jQuery("#canvasOverlaySpan").html("O"),camPos.z=450,animateCamTo()}),sound.addCue(19.42,function(){jQuery("#canvasOverlaySpan").html(""),camPos.z=350,animateCamTo()}),sound.addCue(19.9,function(){camPos.z=250,animateCamTo()}),sound.addCue(20.14,function(){camPos.z=150,animateCamTo()}),sound.addCue(21.83,function(){camPos.z=250,animateCamTo()}),sound.addCue(21.99,function(){camPos.z=350,animateCamTo()}),sound.addCue(22.32,function(){camPos.z=450,animateCamTo()}),sound.addCue(23.29,function(){renderer.autoClearColor=!1,rotateObjectSmooth=!0,animateForeground=!0,animateRandomCharacters=!0,boostDeform=.7,moduloDeform=60,TweenLite.to(camPos,6,{x:300,y:200,z:150,fov:245,ease:Quad.easeOut,onUpdate:animateCamTo})}),sound.addCue(31.03,function(){renderer.autoClearColor=!0,animateForeground=!1,animateRandomCharacters=!1,context3.clearRect(0,0,canvasObjectAnimation.width,canvasObjectAnimation.height),texture3.needsUpdate=!0,moduloDeform=20,TweenLite.to(camPos,2,{x:0,y:0,z:450,fov:45,ease:Quad.easeOut,onUpdate:animateCamTo}),objectRotation=!0,rotateObjectSmooth=!1}),sound.addCue(35.63,function(){camPos.z=200,animateCamTo()}),sound.addCue(35.75,function(){camPos.z=900,animateCamTo()}),sound.addCue(35.87,function(){camPos.z=450,animateCamTo(),rotateObjectSmooth=!0}),sound.addCue(38.77,function(){jQuery("#canvasOverlaySpan").html("G")}),sound.addCue(40.95,function(){jQuery("#canvasOverlaySpan").html("A")}),sound.addCue(41.19,function(){jQuery("#canvasOverlaySpan").html("O")}),sound.addCue(41.67,function(){jQuery("#canvasOverlaySpan").html("")}),sound.addCue(46.53,function(){rotateObjectSmooth=!1,boostDeform=.1,followLight=!0,renderer.autoClearColor=!1}),sound.addCue(54,function(){renderer.autoClearColor=!0,objectRotation=!1,followLight=!1,hideObject(),showEnv(),TweenLite.to(camPos,5,{x:0,y:0,z:650,fov:100,ease:Quad.easeOut,onUpdate:animateCamTo})}),sound.addCue(61.99,function(){showObject(),moduloDeform=50,deformMesh=!0,TweenLite.to(camPos,2,{x:0,y:0,z:450,fov:45,ease:Quad.easeOut,onUpdate:animateCamTo}),animateForeground=!0,rotateObjectSmooth=!0,objectRotation=!0}),sound.addCue(65.87,function(){animateRandomCharacters=!0}),sound.addCue(68.29,function(){camPos.z=350,animateCamTo()}),sound.addCue(68.45,function(){camPos.z=250,animateCamTo()}),sound.addCue(68.77,function(){camPos.z=150,animateCamTo()}),sound.addCue(69.74,function(){animateForeground=!1,objectRotation=!1,context3.clearRect(0,0,canvasObjectAnimation.width,canvasObjectAnimation.height),texture3.needsUpdate=!0,camPos.z=700,animateCamTo(),jQuery("#canvasOverlaySpan").html("G")}),sound.addCue(69.86,function(){jQuery("#canvasOverlaySpan").html("A"),camPos.z=900,animateCamTo()}),sound.addCue(69.99,function(){jQuery("#canvasOverlaySpan").html("O"),camPos.z=450,animateCamTo()}),sound.addCue(70.4,function(){jQuery("#canvasOverlaySpan").html("")}),sound.addCue(73.58,function(){jQuery("#canvasOverlaySpan").html(""),camPos.z=250,animateCamTo()}),sound.addCue(75.69,function(){camPos.z=450,animateCamTo()}),sound.addCue(77.48,function(){boostDeform=2.7,moduloDeform=200,TweenLite.to(camPos,3,{x:300,y:200,z:150,fov:245,ease:Quad.easeIn,onUpdate:animateCamTo})}),sound.addCue(81.35,function(){boostDeform=2.7,moduloDeform=200,TweenLite.to(camPos,10,{x:0,y:0,z:450,fov:45,ease:Quad.easeOut,onUpdate:animateCamTo})}),sound.addCue(82.8,function(){jQuery("#canvasOverlaySpan").html("G")}),sound.addCue(82.93,function(){jQuery("#canvasOverlaySpan").html("A")}),sound.addCue(83.52,function(){jQuery("#canvasOverlaySpan").html("O")}),sound.addCue(83.77,function(){jQuery("#canvasOverlaySpan").html("")}),sound.addCue(92.94,function(){followLight=!0,hideEnv(),renderer.autoClearColor=!1}),sound.addCue(127,function(){renderer.autoClearColor=!0,hideObject(),boostDeform=.1,moduloDeform=120,moduloTarget=0,animateLight=!0,animateForeground=!1,animateRandomCharacters=!1,followLight=!1,scaleObject=!1,deformMesh=!1,objectRotation=!1,rotateObjectSmooth=!1}),sound.addCue(128,function(){TweenLite.to(camPos,.5,{x:0,y:0,z:450,fov:45,ease:Quad.easeOut,onUpdate:animateCamTo})})}function hideEnv(){envMesh.visible=!1}function showEnv(){envMesh.visible=!0}function hideObject(){mainObject.visible=!1}function showObject(){mainObject.visible=!0}var useMP3=!0,fft,analyzer,mic,loaded=!1,spectrum,rms,sound,audioIsPlaying,startTheSketch=!1,muted=!1,canvasLineAnimation,canvasTextAnimation,canvasObjectAnimation,material1,texture1,context1,material2,texture2,context2,material3,texture3,context3,maxAnisotropy,myLines=["MIKE GAO","WHITE STONE","ADV ENT URA","WEB GL"],curLine=0,tickCharacter=0,myTimer,fullText,currentOffset,onCompleteText,curText="",blocks=[],light1,light2,light3,light4,light5,light6,lightTime=4.5,camPos={x:0,y:0,z:400,fov:30},container,camera,scene,renderer,glitchPass,container,JSmouseX=0,JSmouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2,delta,clock=new THREE.Clock,stats,textureCube,envMesh,objectCopy,mainObject,myScale=1,deltaA=0,boostDeform=.1,moduloDeform=120,moduloTarget=0,animateLight=!0,animateForeground=!1,animateRandomCharacters=!1,followLight=!1,scaleObject=!1,deformMesh=!1,objectRotation=!1,rotateObjectSmooth=!1;