function setupTouchEvents(){circleCanvas=document.getElementById("iCanvas"),ctx=circleCanvas.getContext("2d"),circleCanvas.width=window.innerWidth,circleCanvas.height=window.innerHeight,jQuery(document).on("mousedown touchstart",function(a){demoMode&&controls.doGlitch&&(doIncreaseWeight=!1,systemStates.Glitch()),console.log("stopping demo-mode"),demoMode=!1,clearInterval(demoInterval),clearInterval(checkDemoInterval),demoInterval=void 0,checkDemoInterval=void 0,pressingDown=!0,mousePos.x=a.pageX,mousePos.y=a.pageY,timeoutNextState=setTimeout(triggerNextState,2e3),timeoutGlitchState=setTimeout(triggerGlitchState,4600),animateCircle=!0}).on("mouseup mouseleave touchend",function(){pressingDown=!1,clearTimeout(timeoutNextState),clearTimeout(timeoutGlitchState),ctx.clearRect(0,0,circleCanvas.width,circleCanvas.height),animateCircle=!1,doIncreaseWeight=!1})}function triggerNextState(){switch(pressingDown&&(doIncreaseWeight=!0),curState<maxState?curState++:curState=0,curState){case 0:demoMode&&systemStates.Glitch(),systemStates.Pixel();break;case 1:systemStates.Space();break;case 2:systemStates.Body();break;case 3:systemStates.Cube();break;case 4:systemStates.Pose();break;case 5:systemStates.Rotation()}}function triggerGlitchState(){animateCircle=!1,doIncreaseWeight=!1,innerState=0,systemStates.Glitch()}function doCircleAnimation(){animateCircle?(ctx.fillStyle="#ffffff",ctx.strokeStyle="#ffffff",ctx.beginPath(),doIncreaseWeight?(ctx.closePath(),innerState+=1,ctx.fillStyle="#ffffff",ctx.arc(mousePos.x,mousePos.y,innerState,0,2*Math.PI,!1),ctx.fill()):ctx.lineWidth=2,ctx.arc(mousePos.x,mousePos.y,circleSize,0,3*radians(circleState)),ctx.stroke(),circleState+=1):(circleState=0,innerState=0,ctx.clearRect(0,0,circleCanvas.width,circleCanvas.height))}function radians(a){return a*(Math.PI/180)}function setupPostProcessing(){renderPass=new THREE.RenderPass(scene,camera),badTVPass=new THREE.ShaderPass(THREE.BadTVShader),rgbPass=new THREE.ShaderPass(THREE.RGBShiftShader),filmPass=new THREE.ShaderPass(THREE.FilmShader),staticPass=new THREE.ShaderPass(THREE.StaticShader),copyPass=new THREE.ShaderPass(THREE.CopyShader),filmPass.uniforms.grayscale.value=0,badTVParams={show:!1,distortion:1,distortion2:1,speed:0,rollSpeed:0},staticParams={show:!0,amount:.15,size2:8},rgbParams={show:!1,amount:.005,angle:0},filmParams={show:!1,count:500,sIntensity:.6,nIntensity:.4}}function addPostProcessingStates(){if(showPPGui){var a=gui.addFolder("Bad TV");a.add(badTVParams,"show").onChange(onToggleShaders),a.add(badTVParams,"distortion",.1,20).step(.1).listen().name("Thick Distort").onChange(onParamsChange),a.add(badTVParams,"distortion2",.1,20).step(.1).listen().name("Fine Distort").onChange(onParamsChange),a.add(badTVParams,"speed",0,1).step(.01).listen().name("Distort Speed").onChange(onParamsChange),a.add(badTVParams,"rollSpeed",0,1).step(.01).listen().name("Roll Speed").onChange(onParamsChange),a.open();var b=gui.addFolder("RGB Shift");b.add(rgbParams,"show").onChange(onToggleShaders),b.add(rgbParams,"amount",0,.1).listen().onChange(onParamsChange),b.add(rgbParams,"angle",0,2).listen().onChange(onParamsChange),b.open();var c=gui.addFolder("Static");c.add(staticParams,"show").onChange(onToggleShaders),c.add(staticParams,"amount",0,1).step(.01).listen().onChange(onParamsChange),c.add(staticParams,"size2",1,100).step(1).onChange(onParamsChange),c.open();var d=gui.addFolder("Scanlines");d.add(filmParams,"show").onChange(onToggleShaders),d.add(filmParams,"count",50,1e3).onChange(onParamsChange),d.add(filmParams,"sIntensity",0,2).step(.1).onChange(onParamsChange),d.add(filmParams,"nIntensity",0,2).step(.1).onChange(onParamsChange),d.open()}onToggleShaders(),onParamsChange()}function onParamsChange(){badTVPass.uniforms.distortion.value=badTVParams.distortion,badTVPass.uniforms.distortion2.value=badTVParams.distortion2,badTVPass.uniforms.speed.value=badTVParams.speed,badTVPass.uniforms.rollSpeed.value=badTVParams.rollSpeed,staticPass.uniforms.amount.value=staticParams.amount,staticPass.uniforms.size.value=staticParams.size2,rgbPass.uniforms.angle.value=rgbParams.angle*Math.PI,rgbPass.uniforms.amount.value=rgbParams.amount,filmPass.uniforms.sCount.value=filmParams.count,filmPass.uniforms.sIntensity.value=filmParams.sIntensity,filmPass.uniforms.nIntensity.value=filmParams.nIntensity}function randomizeParams(){Math.random()<.2?(badTVParams.distortion=.1,badTVParams.distortion2=.1,badTVParams.speed=0,badTVParams.rollSpeed=0,rgbParams.angle=0,rgbParams.amount=0,staticParams.amount=0):(badTVParams.distortion=10*Math.random()+.1,badTVParams.distortion2=10*Math.random()+.1,badTVParams.speed=.4*Math.random(),badTVParams.rollSpeed=.2*Math.random(),rgbParams.angle=2*Math.random(),rgbParams.amount=.03*Math.random(),staticParams.amount=.2*Math.random()),onParamsChange()}function onToggleShaders(){composer=new THREE.EffectComposer(renderer),composer.setSize(window.innerWidth,window.innerHeight),composer.addPass(renderPass),filmParams.show&&composer.addPass(filmPass),badTVParams.show&&composer.addPass(badTVPass),rgbParams.show&&composer.addPass(rgbPass),staticParams.show&&composer.addPass(staticPass),composer.addPass(copyPass),copyPass.renderToScreen=!0}function init(){animateText("DDD"),animateSubText("//,. Milan, Italy 2017"),initiateTextAnimation(),stats=new Stats,document.getElementById("Stats-output").appendChild(stats.dom),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),camera.position.x=camPos.x,camera.position.y=camPos.y,camera.position.z=camPos.z,camera.fov=camPos.fov,camera.lookAt(new THREE.Vector3(0,0,0)),renderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),renderer.setClearColor(0),renderer.setSize(window.innerWidth,window.innerHeight),renderer.shadowMap.enabled=!0,renderer.domElement.id="threeWebGL",document.getElementById("WebGL-output").appendChild(renderer.domElement),window.addEventListener("resize",onWindowResize,!1),clock=new THREE.Clock,setupPostProcessing(),step=0,addControls(),loadModel(modelOne,baseModelOne,"data/bodyHighRes.dae"),loadModel(modelTwo,baseModelTwo,"data/bodyLowPoly.dae"),setupTouchEvents(),animate()}function animate(){shaderTime+=.1,badTVPass.uniforms.time.value=shaderTime,filmPass.uniforms.time.value=shaderTime,staticPass.uniforms.time.value=shaderTime,demoMode?void 0==demoInterval&&(clearInterval(checkDemoInterval),console.log("activating demo-mode"),demoInterval=setInterval(function(){triggerNextState()},2e4)):void 0==checkDemoInterval&&(checkDemoInterval=setInterval(function(){console.log("re-activating demo-mode"),demoMode=!0},3e4)),requestAnimationFrame(animate),render(),stats.update()}function render(){a+=.01,frameCount++,jQuery(".mainHeading").html(mainString),jQuery(".subHeading").html(subString),controls.rotate&&(modelOne.rotation.y=step+=.01),blinkPixel&&frameCount%30==0&&(blinkPixelState=!blinkPixelState,scene.visible=blinkPixelState),void 0!=cloud&&(cloud.geometry.verticesNeedUpdate=!0),controls.clearBG?renderer.autoClearColor=!0:renderer.autoClearColor=!(frameCount%200<100),composer.render(.1),doCircleAnimation()}function loadModel(a,b,c){var d=new THREE.ColladaLoader;d.options.convertUpAxis=!0,d.load(c,function(d){b=[];var f,e=null;f=d.scene;var g=f.children[0].children[0].geometry,h=new THREE.Mesh(g);e=h.geometry;h.geometry;a=createPointCloud(e),a.scale.x=a.scale.y=a.scale.z=controls.heightScale;for(var j=0;j<a.geometry.vertices.length;j++){var k=a.geometry.vertices[j],l=new THREE.Vector3(k.x,k.y,k.z);b.push(l),a.geometry.vertices[j].x=.01*Math.random(),a.geometry.vertices[j].y=.01*Math.random(),a.geometry.vertices[j].z=.01*Math.random()}scene.add(a),"data/bodyHighRes.dae"==c&&(modelOne=a,baseModelOne=b),"data/bodyLowPoly.dae"==c&&(modelTwo=a,baseModelTwo=b)})}function generateSprite(){var a=document.createElement("canvas");a.width=16,a.height=16;var b=a.getContext("2d");b.fillStyle="#ffffff",b.fillRect(0,0,a.width,a.height);var c=new THREE.Texture(a);return c.needsUpdate=!0,c}function createPointCloud(a){var b=new THREE.PointsMaterial({color:16777215,size:1,opacity:.8,transparent:!0,map:generateSprite()});return cloud=new THREE.Points(a,b),cloud.sortParticles=!0,cloud}function createMesh(a){var b=new THREE.MeshNormalMaterial({});return b.side=THREE.DoubleSide,THREE.SceneUtils.createMultiMaterialObject(a,[b])}function addControls(){function a(){blinkPixel=!0}controls=new function(){this.heightScale=7,this.asParticles=!0,this.rotate=!1,this.clearBG=!0,this.doGlitch=!1,this.scaleMesh=function(){void 0!=modelOne&&controls.heightScale>.1&&(modelOne.scale.x=modelOne.scale.y=modelOne.scale.z=controls.heightScale)},this.doClearBG=function(){}},showPPGui?gui=new dat.GUI:(gui=new dat.GUI({autoPlace:!1}),gui.domElement.id="gui",gui_container.appendChild(gui.domElement)),addPostProcessingStates(),systemStates={Pixel:function(){controls.clearBG=!0,controls.rotate=!1,animateText("Pixel"),controls.heightScale=7,TweenLite.to(camPos,3.3,{x:0,y:0,z:3,fov:10,ease:Quad.easeOut,onUpdate:animateCamTo,onComplete:a});for(var b=cloud.geometry.vertices.length;b--;){var c=cloud.geometry.vertices[b];TweenLite.to(c,4*Math.random(),{x:.001*Math.random(),y:.001*Math.random(),z:.001*Math.random(),ease:Back.easeInOut})}},Space:function(){controls.clearBG=!0,blinkPixel=!1,scene.visible=!0,controls.rotate=!0,animateText("Festival"),controls.heightScale=7,TweenLite.to(camPos,3.3,{x:0,y:0,z:70,fov:30,ease:Quad.easeOut,onUpdate:animateCamTo});for(var a=cloud.geometry.vertices.length;a--;){var b=cloud.geometry.vertices[a];TweenLite.to(b,4*Math.random(),{x:21*Math.random()-10,y:21*Math.random()-10,z:21*Math.random()-10,ease:Back.easeInOut})}},Body:function(){controls.clearBG=!0,blinkPixel=!1,scene.visible=!0,controls.rotate=!0,animateText("OFFF"),controls.heightScale=7,TweenLite.to(camPos,3.3,{x:0,y:0,z:150,fov:30,ease:Quad.easeOut,onUpdate:animateCamTo});for(var a=cloud.geometry.vertices.length;a--;){var b=cloud.geometry.vertices[a],c=baseModelOne[a];TweenLite.to(b,4*Math.random(),{x:c.x,y:c.y,z:c.z,ease:Back.easeInOut})}},Cube:function(){controls.clearBG=!0,blinkPixel=!1,scene.visible=!0,controls.rotate=!0,animateText("Milano"),controls.heightScale=2,TweenLite.to(camPos,3.3,{x:0,y:0,z:200,fov:70,ease:Quad.easeOut,onUpdate:animateCamTo});for(var a=cloud.geometry.vertices.length;a--;){var b=cloud.geometry.vertices[a];TweenLite.to(b,4*Math.random(),{x:21*Math.random()-10,y:21*Math.random()-10,z:21*Math.random()-10,ease:Back.easeInOut})}},Pose:function(){controls.clearBG=!0,blinkPixel=!1,scene.visible=!0,controls.rotate=!0,animateText("2017"),controls.heightScale=7,TweenLite.to(camPos,3.3,{x:0,y:0,z:100,fov:30,ease:Quad.easeOut,onUpdate:animateCamTo});for(var a=cloud.geometry.vertices.length,b=0;a--;){var c=cloud.geometry.vertices[a];if(b<modelTwo.geometry.vertices.length){var d=baseModelTwo[b];TweenLite.to(c,4*Math.random(),{x:d.x,y:d.y,z:d.z,ease:Back.easeInOut}),b++}else{var d=new THREE.Vector3(.001*Math.random()-1e3,.001*Math.random()-1e3,.001*Math.random()-1e3);TweenLite.to(c,4*Math.random(),{x:d.x,y:d.y,z:d.z,ease:Back.easeInOut})}}},Rotation:function(){controls.clearBG=!1,blinkPixel=!1,scene.visible=!0,controls.rotate=!0,animateText("Pixel"),TweenLite.to(camPos,3.3,{x:0,y:200,z:10,fov:5,ease:Quad.easeOut,onUpdate:animateCamTo});for(var a=cloud.geometry.vertices.length,b=0;a--;){var c=cloud.geometry.vertices[a];if(b<modelTwo.geometry.vertices.length){var d=baseModelTwo[b];TweenLite.to(c,4*Math.random(),{x:d.x,y:d.y,z:d.z,ease:Back.easeInOut}),b++}else{var d=new THREE.Vector3(.001*Math.random()-1e3,.001*Math.random()-1e3,.001*Math.random()-1e3);TweenLite.to(c,4*Math.random(),{x:d.x,y:d.y,z:d.z,ease:Back.easeInOut})}}},Glitch:function(){controls.doGlitch=!controls.doGlitch,controls.doGlitch?(badTVParams.show=!0,badTVParams.rollSpeed=.05,badTVParams.speed=.09,badTVParams.distortion=1.4,rgbParams.show=!0):(badTVParams.show=!1,rgbParams.show=!1),onToggleShaders(),onParamsChange()}},gui.add(systemStates,"Pixel"),gui.add(systemStates,"Space"),gui.add(systemStates,"Body"),gui.add(systemStates,"Cube"),gui.add(systemStates,"Pose"),gui.add(systemStates,"Rotation"),gui.add(systemStates,"Glitch"),controls.scaleMesh()}function animateCamTo(){camera.position.set(camPos.x,camPos.y,camPos.z),camera.fov=camPos.fov,camera.lookAt(modelOne.position),camera.updateProjectionMatrix()}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),circleCanvas.width=window.innerWidth,circleCanvas.height=window.innerHeight}function Letter(a,b){this.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz$!&()+,-.=/ 0123456789".shuffle(),this.content=this.chars[this.chars.length-1],this.run=function(){this.content===a?clearInterval(d):(this.chars=this.chars.slice(0,this.chars.length-1),this.content=this.chars[this.chars.length-1]),mainString[b]=this.content};var c=this,d=setInterval(function(){return c.run()},50);mainIntervals.push(d)}function animateText(a){for(var b=0;b<mainIntervals.length;b++){var c=mainIntervals[b];clearInterval(c)}mainIntervals=[],mainString=a.split("");for(var b=0;b<mainString.length;b++){new Letter(mainString[b],b)}}function initiateTextAnimation(){setInterval(function(){var a=textSublines.length,b=Math.floor(Math.random()*a);0==cycleState?(animateSubText(demoMode?"Click and hold to interact":textSublines[b]),cycleState=1):(0==curState&&animateText("DDD"),animateSubText(textSublines[b]),cycleState=0)},1e4)}function subLetter(a,b){this.chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz$!&()+,-.=/0123456789 °^#*<>_".shuffle(),this.content=this.chars[this.chars.length-1],this.run=function(){this.content===a?clearInterval(d):(this.chars=this.chars.slice(0,this.chars.length-1),this.content=this.chars[this.chars.length-1]),subString[b]=this.content};var c=this,d=setInterval(function(){return c.run()},50);subIntervals.push(d)}function animateSubText(a){for(var b=0;b<subIntervals.length;b++){var c=subIntervals[b];clearInterval(c)}subIntervals=[],subString=a.split("");for(var b=0;b<subString.length;b++){new subLetter(subString[b],b)}}var animateCircle=!1,mousePos={x:0,y:0},circleCanvas,ctx,circleSize=150,doIncreaseWeight=!1,timeoutNextState=0,timeoutGlitchState=0,pressingDown=!1,circleState=0,innerState=0,showPPGui=!1,composer,shaderTime=0,badTVParams,badTVPass,staticParams,staticPass,rgbParams,rgbPass,filmParams,filmPass,renderPass,copyPass,pnoise,globalParams;Detector.webgl||Detector.addGetWebGLMessage();var container,stats,camera,scene,renderer,controls,orbitControls,cloud,step,camPos={x:0,y:0,z:3,fov:10},gui,modelOne,baseModelOne=[],modelTwo,baseModelTwo=[],activeModel=0,clock,systemStates,demoMode=!0,demoInterval,checkDemoInterval,curState=0,maxState=5,blinkPixel=!0,blinkPixelState=!1;window.onload=init;var cycleInterval,cycleState=0,a=0,initalClose=!1,frameCount=0;String.prototype.shuffle=function(){for(var a=this.split(""),b=a.length,c=b-1;c>0;c--){var d=Math.floor(Math.random()*(c+1)),e=a[c];a[c]=a[d],a[d]=e}return a.join("")};var mainString=[],mainIntervals=[],textSublines=["/°> innovative thinkers who inspire","<_ digital showcases & installations","°^ a line-up of extraordinary speakers","#* visionary storytellers",",.- post-digital culture festival","//,. Milan, Italy 2017"],subString=[],subIntervals=[];